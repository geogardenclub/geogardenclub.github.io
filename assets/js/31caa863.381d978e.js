"use strict";(self.webpackChunkgeogardenclub_github_io=self.webpackChunkgeogardenclub_github_io||[]).push([[7709],{9229:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>I,contentTitle:()=>G,default:()=>E,frontMatter:()=>D,metadata:()=>r,toc:()=>O});const r=JSON.parse('{"id":"develop/deployment","title":"Deployment","description":"For the GeoGardenClub project, deployment refers to the process by which a version of the GeoGardenClub app is made available on a physical device such as an Apple or Android phone or tablet.","source":"@site/docs/develop/deployment.md","sourceDirName":"develop","slug":"/develop/deployment","permalink":"/docs/develop/deployment","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"hide_table_of_contents":false},"sidebar":"developSidebar","previous":{"title":"Database management","permalink":"/docs/develop/database-management"},"next":{"title":"Screenshots","permalink":"/docs/develop/screenshots"}}');var i=t(4848),a=t(8453),o=t(6540),l=t(8215),s=t(7559),d=t(3104),c=t(6347),h=t(205),p=t(7485),u=t(1682),m=t(679);function b(e){return o.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function g(e){const{values:n,children:t}=e;return(0,o.useMemo)((()=>{const e=n??function(e){return b(e).map((({props:{value:e,label:n,attributes:t,default:r}})=>({value:e,label:n,attributes:t,default:r})))}(t);return function(e){const n=(0,u.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function f({value:e,tabValues:n}){return n.some((n=>n.value===e))}function v({queryString:e=!1,groupId:n}){const t=(0,c.W6)(),r=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,p.aZ)(r),(0,o.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(t.location.search);n.set(r,e),t.replace({...t.location,search:n.toString()})}),[r,t])]}function x(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,i=g(e),[a,l]=(0,o.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!f({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find((e=>e.default))??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:i}))),[s,d]=v({queryString:t,groupId:r}),[c,p]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,r]=(0,m.Dv)(n);return[t,(0,o.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:r}),u=(()=>{const e=s??c;return f({value:e,tabValues:i})?e:null})();(0,h.A)((()=>{u&&l(u)}),[u]);return{selectedValue:a,selectValue:(0,o.useCallback)((e=>{if(!f({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),p(e)}),[d,p,i]),tabValues:i}}var y=t(2303);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function w({className:e,block:n,selectedValue:t,selectValue:r,tabValues:a}){const o=[],{blockElementScrollPositionUntilNextRender:s}=(0,d.a_)(),c=e=>{const n=e.currentTarget,i=o.indexOf(n),l=a[i].value;l!==t&&(s(n),r(l))},h=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=o.indexOf(e.currentTarget)+1;n=o[t]??o[0];break}case"ArrowLeft":{const t=o.indexOf(e.currentTarget)-1;n=o[t]??o[o.length-1];break}}n?.focus()};return(0,i.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.A)("tabs",{"tabs--block":n},e),children:a.map((({value:e,label:n,attributes:r})=>(0,i.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{o.push(e)},onKeyDown:h,onClick:c,...r,className:(0,l.A)("tabs__item",j.tabItem,r?.className,{"tabs__item--active":t===e}),children:n??e},e)))})}function k({lazy:e,children:n,selectedValue:t}){const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=r.find((e=>e.props.value===t));return e?(0,o.cloneElement)(e,{className:(0,l.A)("margin-top--md",e.props.className)}):null}return(0,i.jsx)("div",{className:"margin-top--md",children:r.map(((e,n)=>(0,o.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function S(e){const n=x(e);return(0,i.jsxs)("div",{className:(0,l.A)(s.G.tabs.container,"tabs-container",j.tabList),children:[(0,i.jsx)(w,{...n,...e}),(0,i.jsx)(k,{...n,...e})]})}function C(e){const n=(0,y.A)();return(0,i.jsx)(S,{...e,children:b(e.children)},String(n))}const A={tabItem:"tabItem_Ymn6"};function T({children:e,hidden:n,className:t}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,l.A)(A.tabItem,t),hidden:n,children:e})}const D={hide_table_of_contents:!1},G="Deployment",I={},O=[{value:"Document deployment versions",id:"document-deployment-versions",level:2},{value:"Deployment management",id:"deployment-management",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Update ChangeLog",id:"update-changelog",level:3},{value:"Build the deployment files",id:"build-the-deployment-files",level:3},{value:"1. No signing certificate error",id:"1-no-signing-certificate-error",level:4},{value:"2. iOS version Error",id:"2-ios-version-error",level:4},{value:"Create a release branch",id:"create-a-release-branch",level:3},{value:"Deploy iOS app",id:"deploy-ios-app",level:3},{value:"Deploy Android App",id:"deploy-android-app",level:3},{value:"Shorebird",id:"shorebird",level:2},{value:"Add beta testers",id:"add-beta-testers",level:2}];function N(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"deployment",children:"Deployment"})}),"\n",(0,i.jsx)(n.p,{children:"For the GeoGardenClub project, deployment refers to the process by which a version of the GeoGardenClub app is made available on a physical device such as an Apple or Android phone or tablet."}),"\n",(0,i.jsx)(n.h2,{id:"document-deployment-versions",children:"Document deployment versions"}),"\n",(0,i.jsxs)(n.p,{children:["Each new deployment requires a new version number (specified in the pubspec.yml file), and we document what has changed in each new version via ",(0,i.jsx)(n.a,{href:"https://github.com/geogardenclub/ggc_app/blob/main/CHANGELOG.md",children:"CHANGELOG.md"}),".  To manage version numbers and the changelog file, we use ",(0,i.jsx)(n.a,{href:"https://pub.dev/packages/cider",children:"Cider"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["We also want to be able to access the ChangeLog inside the deployed app---this is a simple way for users to both know what version of the app they have installed, and what new features or changes they can expect to find in a new version.  So, when we do a deployment, the ",(0,i.jsx)(n.code,{children:"run_deploy.sh"})," script will copy the top-level CHANGELOG.md file into the assets/ folder so that it gets included in the various apps."]}),"\n",(0,i.jsx)(n.p,{children:"We adhere to two standards:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["For the changelog format, we adhere to ",(0,i.jsx)(n.a,{href:"https://keepachangelog.com/en/1.0.0/",children:"Keep a Changelog"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["For the version number format, we adhere to ",(0,i.jsx)(n.a,{href:"https://semver.org/spec/v2.0.0.html",children:"Semantic Versioning"}),". For example, for Release 1.0 (Technology Evaluation), the ",(0,i.jsx)(n.em,{children:"major"}),' version is "1". The deploy script automatically increments the minor version and increments the build number.']}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"deployment-management",children:"Deployment management"}),"\n",(0,i.jsx)(n.p,{children:'The deployment process is handled by a single developer referred to as the "Deployment Manager" (DM). Initially, Philip will be the DM.'}),"\n",(0,i.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"Prior to a deployment, it is good practice to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Do a ",(0,i.jsx)(n.a,{href:"/docs/develop/backups",children:"backup"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Run the integrity checker and resolve any violations."}),"\n",(0,i.jsx)(n.li,{children:"Run the integration tests and make sure the main branch does not generate any errors."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"update-changelog",children:"Update ChangeLog"}),"\n",(0,i.jsxs)(n.p,{children:["Invoke ",(0,i.jsx)(n.code,{children:"cider log added <message>"})," to document new additions (or use ",(0,i.jsx)(n.code,{children:"changed"})," or ",(0,i.jsx)(n.code,{children:"fixed"}),") since the last release. Enclose the message in quotes. For example:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'cider log added "Terms and Conditions"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"build-the-deployment-files",children:"Build the deployment files"}),"\n",(0,i.jsxs)(n.p,{children:["Invoke ",(0,i.jsx)(n.code,{children:"./run_deploy.sh"}),".  This script does the following:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Invokes ",(0,i.jsx)(n.code,{children:"cider bump minor"})," and ",(0,i.jsx)(n.code,{children:"cider release"})," so that the unreleased changes are moved to a new release number, and that release number is recorded in the pubspec.yml."]}),"\n",(0,i.jsx)(n.li,{children:"Commits the updated CHANGELOG.md and pubspec.yml files to GitHub."}),"\n",(0,i.jsxs)(n.li,{children:['Creates a "deploy directory" at ',(0,i.jsx)(n.code,{children:"~/Desktop/ggc-deploy-<VERSION>"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Builds the ggc_app.ipa file, uploads it to Shorebird, and copies it to the deploy directory."}),"\n",(0,i.jsx)(n.li,{children:"Builds the app-release.aab file, uploads it to Shorebird, and copies it to the deploy directory."}),"\n",(0,i.jsx)(n.li,{children:"Gets the release notes for the current release and copies them to the deploy directory."}),"\n",(0,i.jsxs)(n.li,{children:["Invokes ",(0,i.jsx)(n.code,{children:"firebase deploy"})," to build and deploy the web version of the app."]}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{title:"Possible iOS build/deployment Errors",type:"info",children:[(0,i.jsx)(n.h4,{id:"1-no-signing-certificate-error",children:"1. No signing certificate error"}),(0,i.jsx)(n.p,{children:"I encountered the following error message when attempting to build the ggc_app.ipa file:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Error (Xcode): No signing certificate "iOS Development" found: \nNo "iOS Development" signing certificate matching team ID\n"8M69898HLM" with a private key was found.\n'})}),(0,i.jsx)(n.p,{children:"The fix was to open XCode, go to the Signing and Capabilities page, and login again."}),(0,i.jsx)(n.h4,{id:"2-ios-version-error",children:"2. iOS version Error"}),(0,i.jsx)(n.p,{children:'I encountered "issues" when running the Transporter which prevented the ggc_app.ipa from being uploaded to App Store Connect. The error message involved an incorrect/missing MinimumOSVersion. To fix it, I eventually had to make sure the MinimumOSVersion was set to the same value (15) in all of the following places:'}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"In XCode > General > Minimum Deployments"}),"\n",(0,i.jsx)(n.li,{children:"In XCode > Build Settings > Deployment > iOS Deployment Target"}),"\n",(0,i.jsx)(n.li,{children:"In ggc_app/ios/Flutter/AppFrameworksInfo.plist (key: MinimumOSVersion)"}),"\n",(0,i.jsx)(n.li,{children:"In ggc_app/ios/Podfile (platform: ios)"}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"create-a-release-branch",children:"Create a release branch"}),"\n",(0,i.jsxs)(n.p,{children:["Once the deploy script has completed, create a new branch off of main called ",(0,i.jsx)(n.code,{children:"release-<version>"}),", for example, ",(0,i.jsx)(n.code,{children:"release-2.26.0"}),". Publish that branch, then switch back to main."]}),"\n",(0,i.jsx)(n.p,{children:"The purpose of the release branch is to create an easily accessible version of the system as it was at the point of the Shorebird release. In particular, Shorebird requires that the pubspec.lock file used to create a patch be identical to the pubspec.lock file used to create a release. By making this release branch, it is easy to switch to a branch with a matching pubspec.lock file in which to incorporate fixes for a patch."}),"\n",(0,i.jsx)(n.h3,{id:"deploy-ios-app",children:"Deploy iOS app"}),"\n",(0,i.jsx)(n.p,{children:"First, open the Transporter app and drag the ggc_app.ipa file from the Desktop folder onto the App."}),"\n",(0,i.jsxs)(n.p,{children:["Second, login to ",(0,i.jsx)(n.a,{href:"https://appstoreconnect.apple.com/login",children:"App Store Connect"}),'. Click on "Apps", then "GeoGardenClub", then "TestFlight".']}),"\n",(0,i.jsx)(n.p,{children:"Wait for a few minutes for the uploaded version to become available for distribution."}),"\n","\n",(0,i.jsxs)(C,{children:[(0,i.jsxs)(T,{value:"app-store",label:"Deploy to App Store",default:!0,children:[(0,i.jsx)(n.p,{children:"To submit for review and release to App Store:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Update the App Review Guidelines google doc and save as PDF."}),"\n",(0,i.jsx)(n.li,{children:'On the Distribution page, click the "+" next to "iOS App" in the left sidebar to create a new version.'}),"\n",(0,i.jsx)(n.li,{children:"Enter the new version number."}),"\n",(0,i.jsx)(n.li,{children:'Under "What\'s New in This Version", add descriptive text.'}),"\n",(0,i.jsx)(n.li,{children:'Under "Build", add the recently uploaded build.'}),"\n",(0,i.jsx)(n.li,{children:'Under "App Review Information", add the App Review Guidelines PDF document as an attachment.'}),"\n",(0,i.jsx)(n.li,{children:'Click "Save", then "Add for Review", then "Submit to App Review".'}),"\n"]})]}),(0,i.jsxs)(T,{value:"testing",label:"Deploy for beta testing",children:[(0,i.jsx)(n.p,{children:"To submit the build for external testing:"}),(0,i.jsx)(n.p,{children:'Click on "External" on the left sidebar, then click the "+" button next to the "Builds" section, and add the most recent build. It will then be submitted for review. This review appears to take 1-7 days to complete.'}),(0,i.jsx)(n.p,{children:"Once review completes successfully, the public URL can be distributed and anyone who already installed the app via that link should be able to update to the new build."})]})]}),"\n",(0,i.jsx)(n.h3,{id:"deploy-android-app",children:"Deploy Android App"}),"\n",(0,i.jsxs)(C,{children:[(0,i.jsxs)(T,{value:"android-deploy-play-store",label:"Deploy to Play Store",default:!0,children:[(0,i.jsxs)(n.p,{children:["Open the ",(0,i.jsx)(n.a,{href:"https://play.google.com/console/u/0/developers/8896023390666377316/app/4974477500315919596/tracks/production",children:"Google Play Console Production page"}),' and click on "Create New Release".']}),(0,i.jsx)(n.p,{children:'Drag the app-release.aab file from the Desktop folder containing the release into the "App Bundle" area to upload it to Google.'}),(0,i.jsx)(n.p,{children:'Wait until the file is uploaded and "optimized for distribution", then click "Next".'}),(0,i.jsx)(n.p,{children:"Check for Warnings and fix if necessary."}),(0,i.jsx)(n.p,{children:'Scroll down to the "Release Notes" section, and click "Add Release Notes". This reveals the "Release Details" section where you can add Release Notes. Click "Next" when finished.'}),(0,i.jsx)(n.p,{children:'Click "Save". When the dialog box comes up for "Go to publishing overview", click "Go to Overview".'}),(0,i.jsx)(n.p,{children:'Click "Send 1 change for review", then "Send changes for review" when that dialog box appears.'}),(0,i.jsxs)(n.p,{children:["You can check the status of publishing in the ",(0,i.jsx)(n.a,{href:"https://play.google.com/console/u/0/developers/8896023390666377316/app/4974477500315919596/publishing",children:"Publishing Overview page"}),". Philip will also get an email."]}),(0,i.jsxs)(n.p,{children:["When published, you can see the results at the ",(0,i.jsx)(n.a,{href:"https://play.google.com/store/apps/details?id=com.geogardenclub.ggc_app",children:"GeoGardenClub Google Play Store listing"}),"."]})]}),(0,i.jsxs)(T,{value:"android-deploy-testing",label:"Deploy for beta testing",children:[(0,i.jsxs)(n.p,{children:["Open the ",(0,i.jsx)(n.a,{href:"https://play.google.com/console/u/0/developers/8896023390666377316/app/4974477500315919596/tracks/internal-testing",children:"Google Play Console Internal Testing Page"}),' and click on "Create new release".']}),(0,i.jsx)(n.p,{children:"Upload app-release.aab file from the folder containing the newly created release."}),(0,i.jsx)(n.p,{children:'Once uploaded, click "Next" to go to the Preview and Confirm page. Ensure that everything looks OK, then click "Save and Publish".'}),(0,i.jsxs)(n.p,{children:["Now go to the ",(0,i.jsx)(n.a,{href:"https://play.google.com/console/u/0/developers/8896023390666377316/app/4974477500315919596/pre-launch-report/overview",children:"Prelaunch Report Overview"})," page. After about an hour, you will be able to check the results of testing on the new version and see if there are any issues that need to be addressed."]}),(0,i.jsx)(n.p,{children:'Finally, "promote" this version to the "Closed testing" track. This triggers an internal review by Google that takes a few days, but is useful as it results in additional quality assurance testing by Google.'})]})]}),"\n",(0,i.jsx)(n.h2,{id:"shorebird",children:"Shorebird"}),"\n",(0,i.jsxs)(n.p,{children:["We use ",(0,i.jsx)(n.a,{href:"https://shorebird.dev/",children:"Shorebird"})," as part of our deployment tool chain. This means that it is possible for us to perform OTA (over the air) updates to released apps."]}),"\n",(0,i.jsx)(n.p,{children:"Consult the Shorebird documentation if an OTA update appears necessary."}),"\n",(0,i.jsx)(n.p,{children:"Currently, only Philip has the authorization at Shorebird to do updates."}),"\n",(0,i.jsx)(n.h2,{id:"add-beta-testers",children:"Add beta testers"}),"\n",(0,i.jsxs)(C,{children:[(0,i.jsxs)(T,{value:"ios-testers",label:"iOS",default:!0,children:[(0,i.jsx)(n.p,{children:'For iOS, we use "external" testing:'}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"The new tester must download the TestFlight app."}),"\n",(0,i.jsx)(n.li,{children:"We supply them with external beta tester URL which will enable them to install (and/or update) the GGC app from within the TestFlight app."}),"\n"]})]}),(0,i.jsxs)(T,{value:"android-testers",label:"Android",children:[(0,i.jsx)(n.p,{children:'For Android, we use the "internal testing" track in Google Play Store:'}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Obtain the gmail address of the new beta tester"}),"\n",(0,i.jsx)(n.li,{children:'Go to the "Internal Testing" page, click on "Testers", and click the right arrow on the line associated with the "GGC Beta Testers" group.'}),"\n",(0,i.jsx)(n.li,{children:'Enter their email address in the "Add email address" text field.'}),"\n",(0,i.jsx)(n.li,{children:'Back on the Tests page, click on the "Copy link" button to obtain the URL to distribute to the new beta tester. They use this URL to download and install the GGC app on their device.'}),"\n"]})]})]})]})}function E(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(N,{...e})}):N(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var r=t(6540);const i={},a=r.createContext(i);function o(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);