"use strict";(self.webpackChunkgeogardenclub_github_io=self.webpackChunkgeogardenclub_github_io||[]).push([[3481],{543:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>d,toc:()=>a});var i=n(5893),s=n(3905);const r={hide_table_of_contents:!1},l="Test Design",d={id:"develop/release-1.0/design-components/test-design",title:"Test Design",description:'For the GeoGardenClub project, we are using JSON files to create the data for the application. The test files are located in one of (potentially many) directories named assets\\test\\fixtureN, when "N" is a number uniquely identifying the fixture. Currently, we only have one fixture directory.',source:"@site/docs/develop/release-1.0/design-components/test-design.md",sourceDirName:"develop/release-1.0/design-components",slug:"/develop/release-1.0/design-components/test-design",permalink:"/docs/develop/release-1.0/design-components/test-design",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{hide_table_of_contents:!1},sidebar:"developSidebar",previous:{title:"Data Mutation",permalink:"/docs/develop/release-1.0/design-components/data-mutation"},next:{title:"ChapterZipMap",permalink:"/docs/develop/release-2.0/chapterzipmap"}},o={},a=[{value:"Fixtures",id:"fixtures",level:2},{value:"Fixture Paths",id:"fixture-paths",level:2},{value:"AssetCollectionBuilder",id:"assetcollectionbuilder",level:2},{value:"TestFixture singleton",id:"testfixture-singleton",level:2},{value:"Unit Tests",id:"unit-tests",level:2},{value:"Running the unit tests",id:"running-the-unit-tests",level:2},{value:"Integration Tests",id:"integration-tests",level:2},{value:"Running the integration tests",id:"running-the-integration-tests",level:2},{value:"Helpers",id:"helpers",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.ah)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"test-design",children:"Test Design"}),"\n",(0,i.jsxs)(t.p,{children:["For the GeoGardenClub project, we are using JSON files to create the data for the application. The test files are located in one of (potentially many) directories named ",(0,i.jsx)(t.code,{children:"assets\\test\\fixtureN"}),', when "N" is a number uniquely identifying the fixture. Currently, we only have one fixture directory.']}),"\n",(0,i.jsx)(t.h2,{id:"fixtures",children:"Fixtures"}),"\n",(0,i.jsx)(t.p,{children:"Each fixture directory must contain the following files:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"badgeData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"badgeInstanceData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"bedData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"chapterData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"cropData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"editorData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"familyData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"gardenData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"gardenerData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"observationData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"outcomeData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"plantingData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"roleData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"seedData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"tagData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"taskData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"userData.json"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"varietyData.json"})}),"\n"]}),"\n",(0,i.jsxs)(t.admonition,{type:"info",children:[(0,i.jsx)(t.p,{children:"The JSON files need to have integrity, so their ids must align. Since many of the GGC IDs end with a four digit millis field we've assigned each type a unique millis field."}),(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"bedIDs end with 3456."}),"\n",(0,i.jsx)(t.li,{children:"cropIDs end with 5678."}),"\n",(0,i.jsx)(t.li,{children:"gardenIDs end with 7890."}),"\n",(0,i.jsx)(t.li,{children:"observationIDs end with 4567."}),"\n",(0,i.jsx)(t.li,{children:"outcomeIDs end with 2345."}),"\n",(0,i.jsx)(t.li,{children:"plantingIDs end with 1234."}),"\n",(0,i.jsx)(t.li,{children:"seedIDs end with 6789."}),"\n",(0,i.jsx)(t.li,{children:"taskIDs end with 8901."}),"\n",(0,i.jsx)(t.li,{children:"varietyIDs end with 9012."}),"\n",(0,i.jsx)(t.li,{children:"badgeInstances end with 9876."}),"\n"]})]}),"\n",(0,i.jsx)(t.h2,{id:"fixture-paths",children:"Fixture Paths"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"lib/features/fixture_paths.dart"})," file defines two constants:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"testFixturePath"})," - the path to the test fixture directory. This constant is used to load the test data in the tests."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"monarchFixturePath"})," - the path to the Monarch fixture directory used by ",(0,i.jsx)(t.code,{children:"WithMonarchData"}),"."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"assetcollectionbuilder",children:"AssetCollectionBuilder"}),"\n",(0,i.jsxs)(t.p,{children:["To facilitate the loading of the fixture files, we have created the ",(0,i.jsx)(t.code,{children:"AssetCollectionBuilder"})," class. This class has three static methods to produce each of the collections from a fixture path. The three methods are as follows:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"Future<List<type>> getTypes(String assetPath)"})," - loads the data from the fixture file and returns a list of the type."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"Future<Stream<List<type>>> getTypesStream(String assetPath)"})," - loads the data from the fixture file and returns a stream of a list of the type."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"Future<TypeCollection> getTypeCollection(String assetPath)"})," - loads the data from the fixture file and returns a collection of the type."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["For example, to create a ",(0,i.jsx)(t.code,{children:"BedCollection"})," from the fixture path, use the following code:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"final bedCollection = await AssetCollectionBuilder.getBedCollection(testFixturePath);\n"})}),"\n",(0,i.jsxs)(t.p,{children:["In addition, the ",(0,i.jsx)(t.code,{children:"AssetCollectionBuilder"})," class has three build methods that build the collections with all the data like the ",(0,i.jsx)(t.code,{children:"WithAllData"})," classes. The methods are as follows"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"buildChapterCollection(String assetPath, String chapterId)"})," - builds a ",(0,i.jsx)(t.code,{children:"ChapterCollection"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"buildGardenCollection(String assetPath, String gardenId)"})," - builds a ",(0,i.jsx)(t.code,{children:"GardenCollection"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"buildUserCollection(String assetPath, String currentUserID, String currentUserUID)"})," - builds a ",(0,i.jsx)(t.code,{children:"UserCollection"}),"."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"testfixture-singleton",children:"TestFixture singleton"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"TestFixture"})," singleton is used to load the test fixture data. The singleton has the following methods:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"getInstance(String assetPath)"})," - returns a Future with the singleton instance. The first time it is called, it will load the test fixture data."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"setup()"})," - initializes the singleton by loading the test fixture data."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"There are two methods for each entity in the test fixture:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"get<Entity>Stream()"})," - returns a Stream of the List of the entities from the test fixture."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"get<Entity>Database()"})," - returns The ",(0,i.jsx)(t.code,{children:"Fixture<Entity>Database"})," from the test fixture."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"unit-tests",children:"Unit Tests"}),"\n",(0,i.jsxs)(t.p,{children:["The tests are located in the ",(0,i.jsx)(t.code,{children:"test"})," directory. The tests are organized by feature using the same directory structure as the feature. For example the ",(0,i.jsx)(t.code,{children:"bed"})," feature has the following test files"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"test/features/bed/domain/bed_collection_test.dart"})," tests for the ",(0,i.jsx)(t.code,{children:"BedCollection"})," class. Currently, just integrity checks for the test fixture and the Monarch fixture."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"running-the-unit-tests",children:"Running the unit tests"}),"\n",(0,i.jsx)(t.p,{children:"To run the tests, use the following command:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"\u22ca> ~/G/G/ggc_app on main \u25e6 flutter test             \n00:08 +39: All tests passed!\n\u22ca> ~/G/G/ggc_app on main \u25e6\n"})}),"\n",(0,i.jsx)(t.h2,{id:"integration-tests",children:"Integration Tests"}),"\n",(0,i.jsxs)(t.p,{children:["The integration tests are located in the ",(0,i.jsx)(t.code,{children:"integration_test"})," directory. We override the providers to use the test fixture. The file ",(0,i.jsx)(t.code,{children:"integration_test/helpers.dart"})," contains n functions:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"initIntegrationTest()"})," - initializes IntegrationTestWidgetsFlutterBinding, Firebase, and FirebaseUIAuth."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"openDrawer(WidgetTester tester)"})," - opens the drawer. There will be other functions to open other widgets."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"gotoScreen(WidgetTester tester, String key)"})," - navigates to the screen with the given key."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"pumpMyApp(WidgetTester tester)"})," - pumps the MyApp widget with overridden providers. The providers get the data from the test fixtures."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"A typical integration test will look like this:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-dart",children:"void main() async {\n  await initIntegrationTest();\n\n  testWidgets('Tests Vendors Drawer pages', (WidgetTester tester) async {\n    // Build our app with test data and trigger a frame.\n    await pumpMyApp(tester);\n    // If we haven't signed in yet, sign in. This isn't working yet.\n    final signIn = find.byKey(ValueKey(WidgetKeys.signInScreen.name));\n    if (signIn.evaluate().isNotEmpty) {\n      // TODO: How do we sign in?\n      return;\n    }\n    // Open the widget under test. In this case, the drawer.\n    await openDrawer(tester);\n    // Verify the we have the options we expect.\n    expect(find.text('Vendors'), findsOneWidget);\n    expect(find.byKey(ValueKey(WidgetKeys.drawerVendors.name)), findsOneWidget);\n    // Navigate to the screen under test.\n    await gotoScreen(tester, WidgetKeys.drawerVendors.name);\n    // Verify that we are on the screen under test.\n    expect(find.byIcon(Icons.expand_more), findsAtLeastNWidgets(5));\n    expect(find.text('Vendors (13)'), findsOneWidget);\n    expect(find.byKey(ValueKey(WidgetKeys.vendorDropdown.name)), findsOneWidget);\n    expect(find.byKey(ValueKey(WidgetKeys.fabAddVendor.name)), findsOneWidget);\n    expect(find.byKey(ValueKey(WidgetKeys.vendorAddSeed.name)), findsNWidgets(4));\n  });\n}\n"})}),"\n",(0,i.jsx)(t.h2,{id:"running-the-integration-tests",children:"Running the integration tests"}),"\n",(0,i.jsxs)(t.p,{children:["The easiest way to run the tests is to run them in Intellij IDEA. Select the ",(0,i.jsx)(t.code,{children:"integration_test"})," directory and right-click on the directory. Select ",(0,i.jsx)(t.code,{children:"Run tests in integration..."}),". Or you can open the test file and run the tests from the IDE."]}),"\n",(0,i.jsx)(t.p,{children:"You can also run them from the command line with the following command:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"\u22ca> ~/G/G/ggc_app on main \u25e6 flutter test integration_test\n"})}),"\n",(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"The simulator must be running."}),"\n",(0,i.jsxs)(t.li,{children:["Since authentication is still managed using the live Firebase authentication, your simulator instances must be logged in with an account with Administrator privileges. In addition, currently, that account must be ",(0,i.jsx)(t.a,{href:"mailto:jennacorindeane@gmail.com",children:"jennacorindeane@gmail.com"}),"."]}),"\n"]})}),"\n",(0,i.jsx)(t.h2,{id:"helpers",children:"Helpers"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"integration_test/helpers.dart"})," file contains the following functions:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"initIntegrationTest()"})," - initializes IntegrationTestWidgetsFlutterBinding, Firebase, and FirebaseUIAuth."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"openDrawer(WidgetTester tester)"})," - opens the drawer. There will be other functions to open other widgets."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"gotoScreen(WidgetTester tester, String key)"})," - navigates to the screen with the given key."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"pumpMyApp(WidgetTester tester)"})," - pumps the MyApp widget with overridden providers. The providers get the data from the test fixtures."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"runIntegrityCheck(WidgetTester tester)"})," - runs the integrity check on the test fixture data. The drawer must be available to run this test. It does not check the number of violations."]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,s.ah)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},3905:(e,t,n)=>{n.d(t,{ah:()=>a});var i=n(7294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){if(null==e)return{};var n,i,s=function(e,t){if(null==e)return{};var n,i,s={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var o=i.createContext({}),a=function(e){var t=i.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},h=i.forwardRef((function(e,t){var n=e.components,s=e.mdxType,r=e.originalType,o=e.parentName,h=d(e,["components","mdxType","originalType","parentName"]),u=a(n),x=s,j=u["".concat(o,".").concat(x)]||u[x]||c[x]||r;return n?i.createElement(j,l(l({ref:t},h),{},{components:n})):i.createElement(j,l({ref:t},h))}));h.displayName="MDXCreateElement"}}]);