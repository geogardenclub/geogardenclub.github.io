"use strict";(self.webpackChunkgeogardenclub_github_io=self.webpackChunkgeogardenclub_github_io||[]).push([[7449],{5960:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>c});var n=i(5893),r=i(1151);const d={hide_table_of_contents:!1,toc_max_heading_level:2},a="Creating a new entity",s={id:"develop/design/entity-creation",title:"Creating a new entity",description:"This document describes how to create a new entity in the GeoGardenClub project. An entity is a new type of object that can be created, read, updated, and deleted (CRUD) in the project. This document assumes that you have already set up your development environment and are familiar with the project's structure.",source:"@site/docs/develop/design/entity-creation.md",sourceDirName:"develop/design",slug:"/develop/design/entity-creation",permalink:"/docs/develop/design/entity-creation",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{hide_table_of_contents:!1,toc_max_heading_level:2},sidebar:"developSidebar",previous:{title:"Data Mutation",permalink:"/docs/develop/design/data-mutation"},next:{title:"Badges",permalink:"/docs/develop/design/badges"}},o={},c=[{value:"1. Create the <code>feature/&lt;entity&gt;</code> directories",id:"1-create-the-featureentity-directories",level:2},{value:"2. Create the Entity in the <code>domain</code> directory",id:"2-create-the-entity-in-the-domain-directory",level:2},{value:"3. Update the <code>repositories/firestore/firestore_path.dart</code> file",id:"3-update-the-repositoriesfirestorefirestore_pathdart-file",level:2},{value:"4. Create the EntityDatabase in the <code>data</code> directory",id:"4-create-the-entitydatabase-in-the-data-directory",level:2},{value:"5. Create the EntityCollection in the <code>domain</code> directory",id:"5-create-the-entitycollection-in-the-domain-directory",level:2},{value:"6. Update the <code>With</code> classes.",id:"6-update-the-with-classes",level:2},{value:"7. Create the Entity UI in the <code>presentation</code> directory",id:"7-create-the-entity-ui-in-the-presentation-directory",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"creating-a-new-entity",children:"Creating a new entity"})}),"\n",(0,n.jsx)(t.p,{children:"This document describes how to create a new entity in the GeoGardenClub project. An entity is a new type of object that can be created, read, updated, and deleted (CRUD) in the project. This document assumes that you have already set up your development environment and are familiar with the project's structure."}),"\n",(0,n.jsxs)(t.h2,{id:"1-create-the-featureentity-directories",children:["1. Create the ",(0,n.jsx)(t.code,{children:"feature/<entity>"})," directories"]}),"\n",(0,n.jsx)(t.p,{children:"The directories are:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"data"})," Firebase Firestore database interface,"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"domain"})," The entity, entity collection and other files, and"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"presentation"})," The entity UI."]}),"\n"]}),"\n",(0,n.jsxs)(t.h2,{id:"2-create-the-entity-in-the-domain-directory",children:["2. Create the Entity in the ",(0,n.jsx)(t.code,{children:"domain"})," directory"]}),"\n",(0,n.jsxs)(t.p,{children:["We are using freezed for data classes. The entity should be a data class with a factory constructor. The entity should have a ",(0,n.jsx)(t.code,{children:"toJson"})," method that converts the entity to a JSON object. The entity should have a ",(0,n.jsx)(t.code,{children:"fromJson"})," factory constructor that creates an entity from a Firestore document."]}),"\n",(0,n.jsxs)(t.p,{children:["For example, the ",(0,n.jsx)(t.code,{children:"Tag"})," entity is defined in ",(0,n.jsx)(t.code,{children:"feature/tag/domain/tag.dart"}),":"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-dart",children:"import 'package:freezed_annotation/freezed_annotation.dart';\n\npart 'tag.freezed.dart';\npart 'tag.g.dart';\n\n/// The string fields are used to filter the list of tags.\nenum TagField {\n  tagID,\n  name,\n  description,\n}\n\n/// Create a Tag with support for reading and writing as JSON.\n@freezed\nclass Tag with _$Tag {\n  const Tag._(); // So we can define methods.\n  const factory Tag(\n      {required String tagID,\n      required String name,\n      required String description}) = _Tag;\n\n  factory Tag.fromJson(Map<String, dynamic> json) => _$TagFromJson(json);\n}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Run ",(0,n.jsx)(t.code,{children:"./run_build_runner.sh"})," to generate the ",(0,n.jsx)(t.code,{children:"<entity>.freezed.dart"})," and ",(0,n.jsx)(t.code,{children:"<entity>.g.dart"})," files."]}),"\n",(0,n.jsxs)(t.h2,{id:"3-update-the-repositoriesfirestorefirestore_pathdart-file",children:["3. Update the ",(0,n.jsx)(t.code,{children:"repositories/firestore/firestore_path.dart"})," file"]}),"\n",(0,n.jsxs)(t.p,{children:["Add paths to the Firestore collections for the entity. For example, the ",(0,n.jsx)(t.code,{children:"Tag"})," entity is defined in ",(0,n.jsx)(t.code,{children:"feature/tag/domain/firestore_path.dart"}),":"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-dart",children:"  static String tags() => 'tags';\n\n  static String tag(String tagID) => '${FirestorePath.tags()}/$tagID';\n"})}),"\n",(0,n.jsxs)(t.h2,{id:"4-create-the-entitydatabase-in-the-data-directory",children:["4. Create the EntityDatabase in the ",(0,n.jsx)(t.code,{children:"data"})," directory"]}),"\n",(0,n.jsx)(t.p,{children:"There are a minimum of three files:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"entity_database.dart"})," with the ",(0,n.jsx)(t.code,{children:"EntityDatabase"})," class,"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"entity_provider.dart"})," with the riverpod providers for the database and the entities, and"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"fixture_entity_database.dart"})," with the ",(0,n.jsx)(t.code,{children:"FixtureEntityDatabase"})," class that is initialized from a JSON file in ",(0,n.jsx)(t.code,{children:"assets/test/fixture1"})," directory. The JSON file is named ",(0,n.jsx)(t.code,{children:"<entity>Data.json"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["Run ",(0,n.jsx)(t.code,{children:"./run_build_runner.sh"})," to generate the Riverpod ",(0,n.jsx)(t.code,{children:"entity_provider.g.dart"})," file."]}),"\n",(0,n.jsxs)(t.h2,{id:"5-create-the-entitycollection-in-the-domain-directory",children:["5. Create the EntityCollection in the ",(0,n.jsx)(t.code,{children:"domain"})," directory"]}),"\n",(0,n.jsxs)(t.p,{children:["The EntityCollection is a class that manages the list of entities. They have a ",(0,n.jsx)(t.code,{children:"List<Entity>"})," and a ",(0,n.jsx)(t.code,{children:"late bool isMonarch"})," field. The ",(0,n.jsx)(t.code,{children:"isMonarch"})," field is used to determine if the entity is from the test fixture.\nCollections typically have the following methods:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"size()"})," returns the number of entities in the collection."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"List<Entity> filter(EntityField field, String fieldValue)"})," returns a filtered list of entities that match the field and value."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"bool isEntityID(String entityID)"})," returns true if the entityID is in the collection."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"Entity getEntity(String entityID)"})," returns the entity with the entityID or throws BadElement exception."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"List<String> getEntityIDs()"})," returns a list of entityIDs in the collection."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"String getNextID()"})," returns the next entityID for the collection. Think about how we are\ngoing to create the nextID. The ids should be\nmeaningful. This method may require additional parameters."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"static List<IntegrityViolation> integrityCheck(ChapterCollection chapters,     GardenCollection gardens, UserCollection users)"})," checks the integrity of the collection."]}),"\n",(0,n.jsx)(t.li,{children:"Any other methods that are needed."}),"\n"]}),"\n",(0,n.jsxs)(t.h2,{id:"6-update-the-with-classes",children:["6. Update the ",(0,n.jsx)(t.code,{children:"With"})," classes."]}),"\n",(0,n.jsxs)(t.p,{children:["Think about where this new collection fits in the ",(0,n.jsx)(t.a,{href:"/docs/develop/data-model",children:"Data Model"}),". In the ",(0,n.jsx)(t.code,{children:"feature/common/with"})," directory update the following files:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"test_fixture.dart"})," Add the FixtureEntityDatabase and the two\nmethods ",(0,n.jsx)(t.code,{children:"getEntityDatabase"})," and ",(0,n.jsx)(t.code,{children:"getEntityStream"})]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"with_all_data.dart"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Add ",(0,n.jsx)(t.code,{children:"final AsyncValue asyncEntities"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["Add the ",(0,n.jsx)(t.code,{children:"if(asyncEntity is AsyncError)"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["Add ",(0,n.jsx)(t.code,{children:"if(asyncEntity is Loading)"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["Update ",(0,n.jsx)(t.code,{children:"if(asyncEntity.hasValue)"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["Create the EntityCollection from the ",(0,n.jsx)(t.code,{children:"asyncEntity.value as List<Entity>"}),"."]}),"\n",(0,n.jsx)(t.li,{children:"Then set up the collections that contain the EntityCollection. You need to update the collection(s) that will contain the EntityCollection."}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"with_core_data.dart"})," or ",(0,n.jsx)(t.code,{children:"with_?_data.dart"})," Add the ",(0,n.jsx)(t.code,{children:"AsyncValue"})," and the changes as above. Update the collection(s) that will contain the EntityCollection."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"with_monarch_data.dart"})," Add a static method that creates the EntityCollection. For example:"]}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-dart",children:'static Future<TagCollection> getTags() async {\n    String content =\n        await rootBundle.loadString("assets/test/fixture1/tagData.json");\n    List<dynamic> initialData = json.decode(content);\n    List<Tag> tags =\n        initialData.map((jsonData) => Tag.fromJson(jsonData)).toList();\n    return TagCollection(tags);\n  }\n'})}),"\n",(0,n.jsxs)(t.p,{children:["Then depending on where the collection fits in the data model, update the ",(0,n.jsx)(t.code,{children:"buildChapterCollection"}),", ",(0,n.jsx)(t.code,{children:"buildGardenCollection"}),", or ",(0,n.jsx)(t.code,{children:"buildUserCollection"})," methods. Update the ",(0,n.jsx)(t.code,{children:"build"})," method to include the new collection in the ",(0,n.jsx)(t.code,{children:"FutureBuilder"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["In the ",(0,n.jsx)(t.code,{children:"feature/common/controller"})," directory update the ",(0,n.jsx)(t.code,{children:"mutate_controller.dart"})," file. Update the ",(0,n.jsx)(t.code,{children:"Future<void> mutate"})," method add the ",(0,n.jsx)(t.code,{children:"entitiesToSet"})," and ",(0,n.jsx)(t.code,{children:"entitiesToDelete"})," fields. Then get the ",(0,n.jsx)(t.code,{children:"entityDatabase"})," from the ",(0,n.jsx)(t.code,{children:"ref.watch(entityDatabaseProvider)"})," and call ",(0,n.jsx)(t.code,{children:"setEntitiesBatch"})," and ",(0,n.jsx)(t.code,{children:"deleteEntitiesBatch"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["In the ",(0,n.jsx)(t.code,{children:"lib/main_test_fixture.dart"})," file override the ",(0,n.jsx)(t.code,{children:"entityDatabaseProvider"})," and ",(0,n.jsx)(t.code,{children:"entitiesProvider"})," with code similar to:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-dart",children:"  entitiesProvider.overrideWith((_) => testFixture.getEntitiesStream()),\n  entityDatabaseProvider\n      .overrideWith((_) => testFixture.getEntityDatabase()),\n"})}),"\n",(0,n.jsxs)(t.p,{children:["In ",(0,n.jsx)(t.code,{children:"integration_tests"})," update ",(0,n.jsx)(t.code,{children:"app_test.dart"})," and ",(0,n.jsx)(t.code,{children:"app_test_single.dart"})," to override the ",(0,n.jsx)(t.code,{children:"entityDatabaseProvider"})," and ",(0,n.jsx)(t.code,{children:"entitiesProvider"})," with code similar to:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-dart",children:"  entityDatabaseProvider.overrideWithProvider(\n      Provider((ref) => ref.watch(entityDatabaseProvider)));\n  entitiesProvider.overrideWithProvider(\n      Provider((ref) => ref.watch(entitiesProvider)));\n"})}),"\n",(0,n.jsxs)(t.h2,{id:"7-create-the-entity-ui-in-the-presentation-directory",children:["7. Create the Entity UI in the ",(0,n.jsx)(t.code,{children:"presentation"})," directory"]})]})}function h(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},1151:(e,t,i)=>{i.d(t,{Z:()=>s,a:()=>a});var n=i(7294);const r={},d=n.createContext(r);function a(e){const t=n.useContext(d);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(d.Provider,{value:t},e.children)}}}]);