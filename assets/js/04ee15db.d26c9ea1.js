"use strict";(self.webpackChunkgeogardenclub_github_io=self.webpackChunkgeogardenclub_github_io||[]).push([[1493],{374:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>d,metadata:()=>i,toc:()=>s});const i=JSON.parse('{"id":"develop/design/input-management","title":"Input Management","description":"Motivation","source":"@site/docs/develop/design/input-management.md","sourceDirName":"develop/design","slug":"/develop/design/input-management","permalink":"/docs/develop/design/input-management","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"hide_table_of_contents":false},"sidebar":"developSidebar","previous":{"title":"ID management","permalink":"/docs/develop/design/ids"},"next":{"title":"\\"With\\" widgets","permalink":"/docs/develop/design/with-widgets"}}');var a=t(4848),r=t(8453);const d={hide_table_of_contents:!1},o="Input Management",l={},s=[{value:"Motivation",id:"motivation",level:2},{value:"Background: Form Builder Input Fields",id:"background-form-builder-input-fields",level:2},{value:"Custom Field Example",id:"custom-field-example",level:2},{value:"GGC Input Fields",id:"ggc-input-fields",level:2},{value:"Global Field Keys",id:"global-field-keys",level:3},{value:"GGC Input fields in forms",id:"ggc-input-fields-in-forms",level:3},{value:"GGC Input field outside of forms",id:"ggc-input-field-outside-of-forms",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"input-management",children:"Input Management"})}),"\n",(0,a.jsx)(n.h2,{id:"motivation",children:"Motivation"}),"\n",(0,a.jsxs)(n.p,{children:['Flutter comes with basic input management facilities that are referred to as "forms" and are documented in the ',(0,a.jsx)(n.a,{href:"https://docs.flutter.dev/cookbook/forms",children:"Flutter Forms Cookbook"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["These facilities can get the job done, but the ",(0,a.jsx)(n.a,{href:"https://pub.dev/packages/flutter_form_builder",children:"Flutter Form Builder"})," package provides additional infrastructure for form processing by reducing the code needed to: (a) build a form, (b) validate fields, (c) react to changes, and (d) collect final user input."]}),"\n",(0,a.jsx)(n.p,{children:"GGC builds on both the basic Flutter form processing and Flutter Form Builder with additional mechanisms to provide three additional simplifications for developers who need to build forms in GGC:"}),"\n",(0,a.jsx)(n.p,{children:"(1) Specialized widgets for commonly used GGC data input fields. For example, a dropdown displaying the names of all gardens associated with this user."}),"\n",(0,a.jsx)(n.p,{children:"(2) A single location for specifying the look-and-feel for input fields.  We want to minimize the amount of duplicated code (and hopefully eliminate look-and-feel code) when creating a form to collect data in a screen."}),"\n",(0,a.jsx)(n.p,{children:"(3) Support for using form fields both within a form and outside of a form without having to create two separate input field widgets."}),"\n",(0,a.jsxs)(n.p,{children:["To support these capabilities, GGC provides a set of custom input fields (in the ",(0,a.jsx)(n.code,{children:"lib/features/common/input-fields directory"}),'). We call these "GGC Input Fields" to distinguish them from "Form Builder Input Fields".']}),"\n",(0,a.jsx)(n.p,{children:"The goal of this page is to document how GGC Input Fields are created and used in order to facilitate their future evolution."}),"\n",(0,a.jsx)(n.h2,{id:"background-form-builder-input-fields",children:"Background: Form Builder Input Fields"}),"\n",(0,a.jsxs)(n.p,{children:["A good overview of Form Builder Input Fields and their use is available in the ",(0,a.jsx)(n.a,{href:"https://pub.dev/packages/flutter_form_builder",children:"Flutter Form Builder Readme"}),". As noted in the ",(0,a.jsx)(n.a,{href:"https://pub.dev/packages/flutter_form_builder#parameters",children:"Parameters section"}),", there are several attributes that all Form Builder Input Fields support. In many cases, a GGC Input Field will provide a value for these standard attributes:"]}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Form Builder Input Field Attribute"}),(0,a.jsx)(n.th,{children:"GGC Input Field Value"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"name"}),(0,a.jsx)(n.td,{children:'The input field name, i.e. "New Garden Name", "Garden Dropdown", etc.'})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"initialValue"}),(0,a.jsx)(n.td,{children:"Not typically needed."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"enabled"}),(0,a.jsx)(n.td,{children:"Same default (true)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"decoration"}),(0,a.jsx)(n.td,{children:"Provided: implements standard border, icons, and styles across all GGC input fields"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"validator"}),(0,a.jsx)(n.td,{children:'Provided as needed. For example, the "New Garden Name" input field will validate that the provided string does not match any other garden name (case-insensitive, spaces and special characters removed).'})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"onChanged"}),(0,a.jsx)(n.td,{children:"Made available in case input field is used outside of a form"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"valueTransformer"}),(0,a.jsx)(n.td,{children:"A function might be provided for some GGC Input Fields, not sure yet."})]})]})]}),"\n",(0,a.jsx)(n.p,{children:'Let\'s look at a simple Form using Form Builder, which displays two text fields ("Email" and "Password") and a "Login" button.'}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"final _formKey = GlobalKey<FormBuilderState>();\n\nFormBuilder(\n  key: _formKey,\n  child: Column(\n    children: [\n      FormBuilderTextField(\n        key: _emailFieldKey,\n        name: 'email',\n        decoration: const InputDecoration(labelText: 'Email'),\n        validator: FormBuilderValidators.compose([\n          FormBuilderValidators.required(),\n          FormBuilderValidators.email(),\n        ]),\n      ),\n      const SizedBox(height: 10),\n      FormBuilderTextField(\n        name: 'password',\n        decoration: const InputDecoration(labelText: 'Password'),\n        obscureText: true,\n        validator: FormBuilderValidators.compose([\n          FormBuilderValidators.required(),\n        ]),\n      ),\n      MaterialButton(\n        color: Theme.of(context).colorScheme.secondary,\n        onPressed: () {\n          if (_formKey.currentState?.saveAndValidate() ?? false) {\n            debugPrint('validation succeeded');\n            debugPrint(_formKey.currentState?.value.toString());\n          } else {\n            debugPrint('validation failed');\n          }\n        },\n        child: const Text('Login'),\n      )\n    ],\n  ),\n),\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Form Builder provides pre-defined input fields for the following types of input controllers: Checkbox, Radio Button, Date Picker, Dropdown, Slider, Toggle, and Text Field. In addition, the ",(0,a.jsx)(n.a,{href:"https://pub.dev/packages/form_builder_extra_fields",children:"Form Builder Extra Fields"})," package provides input controllers for: Color Picker, Rating, Searchable Dropdown, Signature Pad, Spinnable Number Selector, and Text Field with Auto-Complete."]}),"\n",(0,a.jsxs)(n.p,{children:["If you want to build a custom field, there is a set of ",(0,a.jsx)(n.a,{href:"https://github.com/flutter-form-builder-ecosystem/flutter_form_builder/blob/main/example/lib/sources/custom_fields.dart",children:"Example Custom Fields"}),", as well as two how-to articles: ",(0,a.jsx)(n.a,{href:"https://medium.com/@danvickmiller/building-a-custom-flutter-form-builder-field-c67e2b2a27f4",children:"Building a Custom Field with FormBuilder Flutter Package"})," and ",(0,a.jsx)(n.a,{href:"https://medium.com/@danvickmiller/turn-any-flutter-widget-into-a-form-input-c23223042e3b",children:"Turn any widget into a Form Input"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"custom-field-example",children:"Custom Field Example"}),"\n",(0,a.jsx)(n.p,{children:"Here's a simple example of a custom field, built inline:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"FormBuilderField<String?>(\n  name: 'name',\n  builder: (FormFieldState field) {\n    return Autocomplete<String>(\n      optionsBuilder: (TextEditingValue textEditingValue) {\n        if (textEditingValue.text == '') {\n          return const Iterable<String>.empty();\n        }\n        return _kOptions.where((String option) {\n          return option.contains(textEditingValue.text.toLowerCase());\n          });\n        },\n      onSelected: (String selection) {\n        field.didChange(selection);\n        },\n      );\n    },\n  autovalidateMode: AutovalidateMode.always,\n  validator: (valueCandidate) {\n    if (valueCandidate?.isEmpty ?? true) {\n      return 'This field is required.';\n    }\n    return null;\n  },\n),\n"})}),"\n",(0,a.jsx)(n.p,{children:"FormBuilderField has two required fields: name, and builder. There are many optional fields, including: onSaved, initialValue, autovalidateMode, decoration, enabled, validator, valueTransformer, onChanged, and onReset."}),"\n",(0,a.jsx)(n.p,{children:"The above example has the required fields plus two fields to implement validation. The field can return either a String or null."}),"\n",(0,a.jsx)(n.h2,{id:"ggc-input-fields",children:"GGC Input Fields"}),"\n",(0,a.jsx)(n.p,{children:"The above section provided an introduction to generic Form Builder and Input Fields. This section shows how we are building GGC-specific abstractions to address the three design requirements."}),"\n",(0,a.jsx)(n.h3,{id:"global-field-keys",children:"Global Field Keys"}),"\n",(0,a.jsx)(n.p,{children:'One assumption we make in the GGC Input Management design pattern is that a given GGC input controller (i.e. GardenDropdown, CropDropdown, TitleField, etc) appears only once in any given form. This creates an opportunity for simplification by creating a set of "global" field keys, one per input controller. We implement global field keys via the FieldKey class, which contains a set of static fields that are initialized to a GlobalKey instance:'}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"class FieldKey {\n  static GlobalKey<FormBuilderFieldState<FormBuilderField<dynamic>, dynamic>> appearanceOutcome = GlobalKey<FormBuilderFieldState>();\n  static GlobalKey<FormBuilderFieldState<FormBuilderField<dynamic>, dynamic>> badgeDropdown = GlobalKey<FormBuilderFieldState>();\n   :\n   :\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["This class includes a static ",(0,a.jsx)(n.code,{children:"clear()"})," method, which re-initializes the global key values associated with each of the GGC input fields:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"static clear() {\n    appearanceOutcome = GlobalKey<FormBuilderFieldState>(debugLabel: 'appearanceOutcome');\n    badgeDropdown = GlobalKey<FormBuilderFieldState>(debugLabel: 'badgeDropdown');\n    :\n    :\n"})}),"\n",(0,a.jsx)(n.p,{children:"Now, in any screen containing a form, you need to create an instance of a FormKey. In our design pattern, you obtain the formKey by calling ggcFormKey:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:" final formKey = ggcFormKey();\n"})}),"\n",(0,a.jsx)(n.p,{children:"The ggcFormKey() method not only returns a new instance of a FormKey, but it also calls the FieldKey.clear() method, thus creating new instances of all the existing FieldKeys."}),"\n",(0,a.jsx)(n.p,{children:"The use of global field keys means that when you build a form using the GGC Input Fields, you do not need to create and manage field key instances. Instead, when you want to retrieve the value associated with a particular GGC input field (such as in a submit method), you can just reference its associated global field key like this:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"String gardenID = FieldKey.gardenDropdown.currentState?.value;\n"})}),"\n",(0,a.jsxs)(n.admonition,{title:"Limitations of global field keys",type:"warning",children:[(0,a.jsx)(n.p,{children:"Global field keys simplify form creation and processing. But, they come with two important limitations:"}),(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["You can't use global keys if you need a form containing two instances of the same field. Say you wanted a form that contains two Garden dropdowns. You can't simply include two ",(0,a.jsx)(n.code,{children:"GardenDropdown"}),' widgets in your form, because they would share the same global GardenDropdown field key, and thus it would not be possible to select different gardens in the two fields. If you want a form with two Garden dropdowns, you\'ll need to create a new GGC input controller (say, "MultiGardenDropdown") that manages the multiple instances of Garden dropdowns and their associated field keys internally.']}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:'You can\'t "push" into a new Form from a Form, and retain the original field key values.  This is because ggcFormKey() is called each time a new Form is created, and ggcFormKey() reinitializes all of the global field keys.  This is a problem for the Planting form, where we specify a Crop and Variety in the form but also want to "push" into a new Form to create either a new Crop or a new Variety. The UX downside is that after you create the new Crop or Variety and return to the original Planting form, you currently need to re-select the Crop or Variety you intend to use.'}),"\n"]}),"\n"]})]}),"\n",(0,a.jsx)(n.h3,{id:"ggc-input-fields-in-forms",children:"GGC Input fields in forms"}),"\n",(0,a.jsx)(n.p,{children:"This design pattern makes it quite simple to include a GGC Input Field in a form. For example, here is how to add a required dropdown where the user must specify a Garden:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"GardenDropdown(gardens: widget.gardens, chapters: widget.chapters, required: true);\n"})}),"\n",(0,a.jsx)(n.p,{children:"As implied above, the value that you can retrieve from this dropdown in the submit callback is the gardenID. From this, you can easily get the garden name (or any other garden details). For example:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"String gardenID = FieldKey.gardenDropdown.currentState?.value;\nString gardenName = widget.gardens.getGarden(gardenID).name;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"ggc-input-field-outside-of-forms",children:"GGC Input field outside of forms"}),"\n",(0,a.jsx)(n.p,{children:"We can also use the GardenDropdown Input Field in a non-form context. For example, in the Outcomes screen accessible from the Drawer, there is a Garden dropdown such that the displayed outcomes update immediately each time a new garden is selected."}),"\n",(0,a.jsx)(n.p,{children:"To do this, the Outcomes screen must provide an onTap function which is called each time the dropdown is manipulated.  Here's is how the GardenDropdown can be called to provide this functionality:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"GardenDropdown(\n  gardens: widget.gardens,\n  chapters: widget.chapters,\n  gardenID: gardenID,\n  initialValue: gardenID ?? 'All',\n  addAll: true,\n  enabled: widget.gardenID == null,\n  onTap: (value) => setState(() {\n    gardenID = (value == 'All') ? null : value;\n    cropID = null;\n    varietyID = null;\n  }),\n);\n"})}),"\n",(0,a.jsx)(n.p,{children:"In this situation, we pass in an onTap method that calls setState() to update local state variables for gardenID, cropID, and varietyID. This forces a rebuild of the screen with those new state values, which in turn recomputes the outcomes to be displayed."}),"\n",(0,a.jsx)(n.p,{children:"This example illustrates how GardenDropdown achieves the three design goals:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"It is specialized for a given GGC entity. The client just passes in the gardens and chapters collection instances and GardenDropdown does the work of extracting garden names and IDs and building the dropdown object."}),"\n",(0,a.jsx)(n.li,{children:'The invocation of the GardenDropdown has no "look-and-feel" code associated with it. All of the decoration and theme data is internal.'}),"\n",(0,a.jsx)(n.li,{children:"The GardenDropdown can be used both within a form (where the data is extracted using a FormKey) or outside a form (where the data is extracted using an onTap callback)."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>o});var i=t(6540);const a={},r=i.createContext(a);function d(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);