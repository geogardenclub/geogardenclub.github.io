"use strict";(self.webpackChunkgeogardenclub_github_io=self.webpackChunkgeogardenclub_github_io||[]).push([[9690],{662:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"develop/quality-assurance/integrity-check","title":"Integrity Checking","description":"We use a Firestore Database to store the (textual) \\"documents\\" associated with GGC, and Firestore Cloud Storage to store the (binary) image files that users upload to associate with Observation, Garden, and other documents. Let\'s call the combination of our Firestore Database and our Cloud Storage the GGC \\"repository\\".","source":"@site/docs/develop/quality-assurance/integrity-check.md","sourceDirName":"develop/quality-assurance","slug":"/develop/quality-assurance/integrity-check","permalink":"/docs/develop/quality-assurance/integrity-check","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"hide_table_of_contents":true},"sidebar":"developSidebar","previous":{"title":"Testing","permalink":"/docs/develop/quality-assurance/testing"},"next":{"title":"Technology Goals","permalink":"/docs/develop/releases/release-1.0/goals"}}');var o=a(4848),i=a(8453);const s={hide_table_of_contents:!0},r="Integrity Checking",c={},l=[{value:"Database Integrity Check",id:"database-integrity-check",level:2},{value:"Cloud Storage Integrity Check",id:"cloud-storage-integrity-check",level:2}];function d(e){const t={h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"integrity-checking",children:"Integrity Checking"})}),"\n",(0,o.jsx)(t.p,{children:'We use a Firestore Database to store the (textual) "documents" associated with GGC, and Firestore Cloud Storage to store the (binary) image files that users upload to associate with Observation, Garden, and other documents. Let\'s call the combination of our Firestore Database and our Cloud Storage the GGC "repository".'}),"\n",(0,o.jsx)(t.p,{children:"One important quality assurance issue is to ascertain whether the GGC repository is in a consistent state. In other words, does the repository exhibit integrity?  Integrity means satisfying the following constraints:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:'If one document "points" to another document (or image), then that document (or image) actually exists. For example, every Planting document contains a Garden ID field, and that Garden ID must be able to be resolved to an actual Garden document.'}),"\n",(0,o.jsx)(t.li,{children:"If a document is dependent upon the existence of another document, then that other document exists. For example, if there is an image that is defined as being associated with a Garden document, then that Garden document actually exists."}),"\n",(0,o.jsx)(t.li,{children:'If certain values are "cached" for performance reasons, then those cached values are correct. For example, if a Garden document caches a list of variety IDs, then if you traverse all the Plantings associated with that Garden and collect the variety IDs actually associated with the Garden, that list should exactly match the cached list.'}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"If our code was perfectly correct at all times, then the repository would always exhibit integrity. But we're not that good. For example, if we delete a Garden document without deleting all of its associated Planting documents, then there could be a Planting document in the repository with a Garden ID that does not point to an existing Garden document. Similarly, we could have \"dangling\" image documents, or cached values that don't truly represent the actual contents of the Garden or Chapter."}),"\n",(0,o.jsx)(t.p,{children:"The way we deal with this issue is through two Admin commands: Database Integrity Check and Cloud Storage Integrity Check.  These commands enable us to verify Integrity and if problems exist, provide helpful information to enable us to fix the database or cloud storage manually. They are located in the Database Management screen:"}),"\n",(0,o.jsx)("img",{width:"300px",src:"/img/develop/quality-assurance/database-management.png"}),"\n",(0,o.jsx)(t.h2,{id:"database-integrity-check",children:"Database Integrity Check"}),"\n",(0,o.jsx)(t.p,{children:"The Database Integrity Check command focuses on the Firestore Database documents, and focuses on all the non-image related integrity constraints:"}),"\n",(0,o.jsx)("img",{width:"300px",src:"/img/develop/quality-assurance/database-integrity-check.png"}),"\n",(0,o.jsx)(t.p,{children:'Essentially, each of the Collection classes associated with the Firestore Database collections is responsible for implementing an "Integrity Check" method that checks all of its documents.'}),"\n",(0,o.jsx)(t.p,{children:"The Database Integrity Check mechanism runs in less than a second."}),"\n",(0,o.jsx)(t.p,{children:"If the mechanism finds violations, then it is up to a developer to figure out how to restore integrity to the database. This might mean manually manipulating documents using the Firebase console, or writing a new DB Operation command to update the database. And, of course, trying to fix the code so that this problem does not occur again in future."}),"\n",(0,o.jsx)(t.h2,{id:"cloud-storage-integrity-check",children:"Cloud Storage Integrity Check"}),"\n",(0,o.jsx)(t.p,{children:'The Cloud Storage Integrity Check command tests to see that there are no "dangling references" in our image files. This means:'}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"All the URLs in our Firestore Database documents actually point to a file in Cloud Storage, and"}),"\n",(0,o.jsx)(t.li,{children:"All the images in our Cloud Storage are referenced by (at least) one Firestore Database document."}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"Here is what this command looks like:"}),"\n",(0,o.jsx)("img",{width:"300px",src:"/img/develop/quality-assurance/cloud-storage-integrity-check.png"}),"\n",(0,o.jsx)(t.p,{children:"Before running this command, it is important to open the Firebase Storage console and check that our GGC bucket has exactly three top-level folders: application-images/, backups/, and images/."}),"\n",(0,o.jsx)("img",{width:"700px",src:"/img/develop/quality-assurance/storage-console.png"}),"\n",(0,o.jsx)(t.p,{children:"If the top level of our bucket contains more than these three folders, it indicates that a user has uploaded an image using an old version of the app. If this is the case, then before running this command, you should:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"Run DBOperation36 to migrate the incorrectly placed image files to the appropriate location in Cloud Storage and update the associated Database documents."}),"\n",(0,o.jsx)(t.li,{children:"Delete the offending files/folders manually from Cloud Storage using the console so that only the appropriate three top-level folders remain."}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"Now you can run the Cloud Storage Integrity Check command. Note that it takes around 5 minutes to run."}),"\n",(0,o.jsx)(t.p,{children:"Again, if this command detects problems, then it is up to the developer to figure out how to manually (or automatically using a DBOperation) to restore integrity."})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,t,a)=>{a.d(t,{R:()=>s,x:()=>r});var n=a(6540);const o={},i=n.createContext(o);function s(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);